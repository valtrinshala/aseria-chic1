var C=function(){var m,h,k=function(){m=FormValidation.formValidation(h,{fields:{title:{validators:{notEmpty:{message:window.keys.modifierTitle}}},price:{validators:{notEmpty:{message:window.keys.priceRequired},regexp:{regexp:/^[0-9]+(\.[0-9]{1,7})?$/,message:window.keys.regexRequired}}},cost:{validators:{notEmpty:{message:window.keys.costRequired},regexp:{regexp:/^[0-9]+(\.[0-9]{1,7})?$/,message:window.keys.regexRequired}}},selected_ingredients:{validators:{notEmpty:{message:window.keys.ingredientsRequired}}}},plugins:{trigger:new FormValidation.plugins.Trigger,bootstrap:new FormValidation.plugins.Bootstrap5({rowSelector:".fv-row",eleInvalidClass:"",eleValidClass:""})}}),$("#categories").change(function(){var t=$(this).find("option:selected"),a=t.data("color");$(".categoryColor").css("background-color",a)});let p=[];$("#kt_customers_table tbody tr").each(function(){p.push(this.id)});const l=$('label[for="cost"]').data("currency")??"â‚¬",x=$('label[for="cost"]').data("direction")??"end";$("#ingredientDropdown").on("change",function(){let t=JSON.parse($(this).val()),a="/admin/ingredient/"+t.id+"/edit";if(!t||p.includes(t.id))return;{p.push(t.id);var o=$("#kt_customers_table tbody"),e=$('<tr id="'+t.id+'"></tr>'),n=[];for(var i in window.units)((t.unit.toLowerCase()==="kilogram"||t.unit.toLowerCase()==="gram")&&(i.toLowerCase()==="kilogram"||i.toLowerCase()==="gram")||(t.unit.toLowerCase()==="liter"||t.unit.toLowerCase()==="milliliter")&&(i.toLowerCase()==="liter"||i.toLowerCase()==="milliliter")||t.unit===window.units[i])&&n.push("<option "+(t.unit===window.units[i]?"selected":"")+' value="'+i+'">'+window.units[i]+"</option>");let s=t.unit.toLowerCase()==="milliliter"||t.unit.toLowerCase()==="gram"?.001:1;e.append('<input id="qty-'+t.id+'" data-qty-final="'+t.id+'" type="hidden" name="ingredients['+t.id+'][qty]" value=1>'),e.append('<input id="qty-'+t.id+'" data-unit-final="'+t.id+'" type="hidden" name="ingredients['+t.id+'][unit]" value="'+t.unit+'">'),e.append('<input id="qty-'+t.id+'" data-cost-final="'+t.id+'" type="hidden" name="ingredients['+t.id+'][cost]" value="'+t.cost+'">'),e.append('<input id="qty-'+t.id+'" data-price-final="'+t.id+'" type="hidden" name="ingredients['+t.id+'][price]" value="'+t.price+'">'),e.append('<input id="qty-'+t.id+'" data-cost-per-unit-final="'+t.id+'" type="hidden" name="ingredients['+t.id+'][cost_per_unit]" value="'+s*t.cost+'">'),e.append('<input id="qty-'+t.id+'" data-price-per-unit-final="'+t.id+'" type="hidden" name="ingredients['+t.id+'][price_per_unit]" value="'+s*t.price+'">'),e.append('<td class="text-gray-900"><a href="'+a+'" class="text-gray-800 text-hover-primary mb-1">'+t.name+"</a></td>"),e.append('<td class="text-gray-900" data-quantity = "'+t.quantity+'">'+parseFloat(t.quantity)+" "+t.unit+"</td>"),e.append('<td class="text-gray-900"><input data-system-unit="'+t.unit+'"  value="1" type="number" step="0.1" data-qty="qty" class="form-control qty-units"></td>'),e.append('<td class="text-gray-900"><select class="form-select form-control qty-units" data-control="select2" data-hide-search="true" data-unit="unit"><option></option>'+n.join("")+"</select></td>"),x=="end"?(e.append('<td class="text-gray-900" data-final-cost = "'+parseFloat(t.cost).toFixed(2)+'" data-cost = "'+parseFloat(t.cost).toFixed(2)+'">'+parseFloat(t.cost).toFixed(2)+"  "+l+"</td>"),e.append('<td class="text-gray-900" data-final-price = "'+parseFloat(t.price).toFixed(2)+'" data-price = "'+parseFloat(t.price).toFixed(2)+'">'+parseFloat(t.price).toFixed(2)+"  "+l+"</td>")):(e.append('<td class="text-gray-900" data-final-cost = "'+parseFloat(t.cost).toFixed(2)+'" data-cost = "'+parseFloat(t.cost).toFixed(2)+'">'+l+" "+parseFloat(t.cost).toFixed(2)+"</td>"),e.append('<td class="text-gray-900" data-final-price = "'+parseFloat(t.price).toFixed(2)+'" data-price = "'+parseFloat(t.price).toFixed(2)+'">'+l+" "+parseFloat(t.price).toFixed(2)+"</td>")),e.append('<td class="float-right pe-0"><div class="float-end menu-item px-3 pe-0"><a href="javascript:void(0)" class="menu-link px-3 text-danger" data-ingredient-id="new_id" data-kt-customer-table-filter="delete_row">Delete</a></div></td>'),o.append(e)}var r=0,d=0;$("#kt_customers_table tbody tr").each(function(){let s=parseInt($(this).find("#qty-"+this.id).val());r+=$(this).find("[data-cost]").attr("data-cost")*s,d+=$(this).find("[data-price]").attr("data-price")*s}),$("#cost").val(r.toFixed(2)),$("#price").val(d.toFixed(2));let c=document.getElementById("ingredientDropdown");c.selectedIndex=-1;try{KTMenu.init()}catch{}}),$("#kt_customers_table tbody").on("input",".qty-units",function(){let t=$(this).closest("tr"),a=t.find("[data-qty]").val(),o=t.find("[data-unit]").val(),e=parseFloat(t.find("[data-cost]").data("cost")),n=parseFloat(t.find("[data-price]").data("price")),i=t.find("[data-system-unit]").data("system-unit"),r,d;const c=i.toLowerCase(),s=o.toLowerCase(),v={liter:{milliliter:.001},milliliter:{liter:1e3},kilogram:{gram:.001},gram:{kilogram:1e3}};if(c===s||s==="unit")r=e*a,d=n*a;else if(v.hasOwnProperty(c)&&v[c].hasOwnProperty(s)){const b=v[c][s];r=e*a*b,d=n*a*b}else alert("The units are incorrect!");t.find("[data-qty-final]").val(a),t.find("[data-unit-final]").val(o);let w=o.toLowerCase()==="milliliter"||o.toLowerCase()==="gram"?.001:1;t.find("[data-cost-final]").val(r),t.find("[data-price-final]").val(d),t.find("[data-cost-per-unit-final]").val(r*w),t.find("[data-price-per-unit-final]").val(d*w),t.find("[data-final-cost]").attr("data-final-cost",r.toFixed(2)),t.find("[data-final-price]").attr("data-final-price",d.toFixed(2)),x==="end"?(t.find("[data-cost]").text(r.toFixed(2)+" "+l),t.find("[data-price]").text(d.toFixed(2)+" "+l),t.find("[data-final-cost]").attr("data-final-cost",r.toFixed(2))):(t.find("[data-cost]").text(l+" "+r.toFixed(2)),t.find("[data-price]").text(l+" "+d.toFixed(2)),t.attr("data-final-cost",r.toFixed(2)),t.attr("data-final-price",d.toFixed(2)));let _=0,F=0;$("#kt_customers_table tbody tr").each(function(){_+=parseFloat($(this).find("[data-final-cost]").attr("data-final-cost")),F+=parseFloat($(this).find("[data-final-price]").attr("data-final-price"))}),$("#cost").val(_.toFixed(2)),$("#price").val(F.toFixed(2))}),$("#kt_customers_table tbody").on("click",'[data-kt-customer-table-filter="delete_row"]',function(){var t=$(this).closest("tr");if(t.length>0){var a=t[0].id;t.remove(),p=p.filter(function(n){return n!==a})}let o=0,e=0;$("#kt_customers_table tbody tr").each(function(){o+=parseFloat($(this).find("[data-final-cost]").attr("data-final-cost")),e+=parseFloat($(this).find("[data-final-price]").attr("data-final-price"))}),$("#cost").val(o.toFixed(2)),$("#price").val(e.toFixed(2))});let u=$("#colorDiv"),y=$("#infoSpanColor"),f=$("#iconDiv"),g=$("#infoSpanDiv");u.show(),f.hide(),$('#kt_security_summary_tabs a[data-bs-toggle="tab"]').click(function(){switch($(this).attr("href")){case"#kt_security_summary_tab_pane_hours":u.show(),y.show(),f.hide(),g.hide();break;case"#kt_security_summary_tab_pane_day":u.hide(),y.hide(),f.show(),g.show();break;default:u.show(),y.show(),f.hide(),g.hide()}}),$("#submitButton").on("click",function(){$("#kt_ecommerce_add_modifier_form").submit()}),$("#kt_ecommerce_add_modifier_form").submit(function(t){$("#kt_customers_table tbody tr").length===0?$("#selected_ingredients").val(""):$("#selected_ingredients").val("has ingredients"),t.preventDefault(),m&&m.validate().then(function(a){if(a=="Valid"){var o=new FormData($("#kt_ecommerce_add_modifier_form")[0]);o.append("_method","PUT"),$.ajax({url:"/admin/modifier/"+$("#pageId").val(),type:"POST",data:o,contentType:!1,processData:!1,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(e){Swal.fire({text:window.keys.modifierUpdated,icon:"success",buttonsStyling:!1,confirmButtonText:window.keys.confirmButtonOk,customClass:{confirmButton:"btn btn-primary"}}).then(function(){location.href="/admin/modifier"})},statusCode:{422:function(e){let n=window.keys.ekioskErrorMessage+`

`;for(let i in e.responseJSON.errors)n+=`${e.responseJSON.errors[i].join(", ")}
`;Swal.fire({text:n,icon:"error",buttonsStyling:!1,confirmButtonText:window.keys.confirmButtonOk,customClass:{confirmButton:"btn btn-primary"}})}},error:function(e){Swal.fire({text:window.keys.ekioskServerErrors,icon:"error",buttonsStyling:!1,confirmButtonText:window.keys.confirmButtonOk,customClass:{confirmButton:"btn btn-primary"}})}})}else Swal.fire({text:window.keys.ekioskErrorsDetected,icon:"error",buttonsStyling:!1,confirmButtonText:window.keys.confirmButtonOk,customClass:{confirmButton:"btn btn-primary"}})})})};return{init:function(){h=document.querySelector("#kt_ecommerce_add_modifier_form"),k()}}}();KTUtil.onDOMContentLoaded(function(){C.init()});
