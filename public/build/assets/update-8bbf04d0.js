var g=function(){var p,y,k=function(){p=FormValidation.formValidation(y,{fields:{name:{validators:{notEmpty:{message:window.keys.dealName}}},"foodItems[]":{validators:{notEmpty:{message:window.keys.productName}}},categories:{validators:{notEmpty:{message:window.keys.categoryRequired}}},price:{validators:{notEmpty:{message:window.keys.priceRequired},regexp:{regexp:/^[0-9]+(\.[0-9]{1,7})?$/,message:window.keys.regexRequired}}},cost:{validators:{notEmpty:{message:window.keys.costRequired},regexp:{regexp:/^[0-9]+(\.[0-9]{1,7})?$/,message:window.keys.regexRequired}}},selected_foodItems:{validators:{notEmpty:{message:window.keys.productName}}}},plugins:{trigger:new FormValidation.plugins.Trigger,bootstrap:new FormValidation.plugins.Bootstrap5({rowSelector:".fv-row",eleInvalidClass:"",eleValidClass:""})}});let c=$("#colorDiv"),f=$("#infoSpanColor"),l=$("#iconDiv"),u=$("#infoSpan");c.show(),l.hide(),$('#kt_security_summary_tabs a[data-bs-toggle="tab"]').click(function(){switch($(this).attr("href")){case"#kt_security_summary_tab_pane_hours":c.show(),f.show(),l.hide(),u.hide();break;case"#kt_security_summary_tab_pane_day":c.hide(),f.hide(),l.show(),u.show();break;default:c.show(),f.show(),l.hide(),u.hide()}}),$("#categories").change(function(){var t=$(this).find("option:selected"),r=t.data("color");$(".categoryColor").css("background-color",r)});var s=[];$("#kt_customers_table tbody tr").each(function(){s.push(this.id)});const i=$('label[for="cost"]').data("currency")??"â‚¬",v=$('label[for="cost"]').data("direction")??"end";$("#foodItemDropdown").on("change",function(){var t=JSON.parse($(this).val()),r="/admin/foodItem/"+t.id+"/edit";if(!t)return;if(s.includes(t.id)){let a=$("#"+t.id),h=a.find("#qty-"+t.id),n=parseInt(h.val(parseInt(h.val())+1).val());parseInt(a.find("[data-qty]").text(n)),v=="end"?(a.find("[data-cost]").text((n*a.find("[data-cost]").attr("data-cost")).toFixed(2)+" "+i),a.find("[data-price]").text((n*a.find("[data-price]").attr("data-price")).toFixed(2)+" "+i)):(a.find("[data-cost]").text(i+" "+(n*a.find("[data-cost]").attr("data-cost")).toFixed(2)),a.find("[data-price]").text(i+" "+(n*a.find("[data-price]").attr("data-price")).toFixed(2)))}else{s.push(t.id);var d=$("#kt_customers_table tbody"),e=$('<tr id="'+t.id+'"></tr>');e.append('<input id="qty-'+t.id+'" type="hidden" name="foodItems['+t.id+']" value="1">'),e.append('<td><a href="'+r+'" class="text-gray-800 text-hover-primary mb-1">'+t.name+"</a></td>"),e.append('<td data-qty = "1">1</td>'),v=="end"?(e.append('<td data-cost = "'+parseFloat(t.cost).toFixed(2)+'">'+parseFloat(t.cost).toFixed(2)+"  "+i+"</td>"),e.append('<td data-price = "'+parseFloat(t.price).toFixed(2)+'">'+parseFloat(t.price).toFixed(2)+"  "+i+"</td>")):(e.append('<td data-cost = "'+parseFloat(t.cost).toFixed(2)+'">'+i+" "+parseFloat(t.cost).toFixed(2)+"</td>"),e.append('<td data-price = "'+parseFloat(t.price).toFixed(2)+'">'+i+" "+parseFloat(t.price).toFixed(2)+"</td>")),e.append('<td class="float-right pe-0"><div class="float-end menu-item px-3 pe-0"><a href="javascript:void(0)" class="menu-link px-3 text-danger" data-foodItem-id="new_id" data-kt-customer-table-filter="delete_row">Delete</a></div></td>'),d.append(e)}var o=0,m=0;$("#kt_customers_table tbody tr").each(function(){let a=parseInt($(this).find("#qty-"+this.id).val());o+=$(this).find("[data-cost]").attr("data-cost")*a,m+=$(this).find("[data-price]").attr("data-price")*a}),$("#cost").val(o),$("#price").val(m);let _=document.getElementById("foodItemDropdown");_.selectedIndex=-1;try{KTMenu.init()}catch{}}),$("#kt_customers_table tbody").on("click",'[data-kt-customer-table-filter="delete_row"]',function(){var t=$(this).closest("tr");if(t.length>0){var r=t[0].id;t.remove(),s=s.filter(function(o){return o!==r})}var d=0,e=0;$("#kt_customers_table tbody tr").each(function(){let o=parseInt($(this).find("#qty-"+this.id).val());e+=$(this).find("[data-cost]").attr("data-cost")*o,d+=$(this).find("[data-price]").attr("data-price")*o}),$("#price").val(d),$("#cost").val(e)}),$("#submitButton").on("click",function(){$("#kt_ecommerce_add_meal_form").submit()}),$("#kt_ecommerce_add_meal_form").submit(function(t){$("#kt_customers_table tbody tr").length===0?$("#selected_foodItems").val(""):$("#selected_foodItems").val("has food items"),t.preventDefault(),p&&p.validate().then(function(r){if(r=="Valid"){var d=new FormData($("#kt_ecommerce_add_meal_form")[0]);d.append("_method","PUT"),$.ajax({url:"/admin/meal/"+$("#pageId").val(),type:"POST",data:d,contentType:!1,processData:!1,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(e){Swal.fire({text:window.keys.dealSuccessfullyAdded,icon:"success",buttonsStyling:!1,confirmButtonText:window.keys.confirmButtonOk,customClass:{confirmButton:"btn btn-primary"}}).then(function(){location.href="/admin/meal"})},statusCode:{422:function(e){let o=window.keys.ekioskErrorMessage+`

`;for(let m in e.responseJSON.errors)o+=`${e.responseJSON.errors[m].join(", ")}
`;Swal.fire({text:o,icon:"error",buttonsStyling:!1,confirmButtonText:window.keys.confirmButtonOk,customClass:{confirmButton:"btn btn-primary"}})}},error:function(e){Swal.fire({text:window.keys.ekioskServerErrors,icon:"error",buttonsStyling:!1,confirmButtonText:window.keys.confirmButtonOk,customClass:{confirmButton:"btn btn-primary"}})}})}else Swal.fire({text:window.keys.ekioskErrorsDetected,icon:"error",buttonsStyling:!1,confirmButtonText:window.keys.confirmButtonOk,customClass:{confirmButton:"btn btn-primary"}})})})};return{init:function(){y=document.querySelector("#kt_ecommerce_add_meal_form"),k()}}}();KTUtil.onDOMContentLoaded(function(){g.init()});
