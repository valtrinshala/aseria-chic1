var B=function(){var w,b,S=function(){w=FormValidation.formValidation(b,{fields:{name:{validators:{notEmpty:{message:window.keys.productNameRequired}}},"ingredients[]":{validators:{notEmpty:{message:window.keys.ingredientsRequired}}},categories:{validators:{notEmpty:{message:window.keys.categoryRequired}}},price:{validators:{notEmpty:{message:window.keys.priceRequired},regexp:{regexp:/^[0-9]+(\.[0-9]{1,7})?$/,message:window.keys.regexRequired}}},cost:{validators:{notEmpty:{message:window.keys.costRequired},regexp:{regexp:/^[0-9]+(\.[0-9]{1,7})?$/,message:window.keys.regexRequired}}},"small[price]":{validators:{regexp:{regexp:/^[0-9]+(\.[0-9]{1,7})?$/,message:window.keys.regexRequired}}},"medium[price]":{validators:{regexp:{regexp:/^[0-9]+(\.[0-9]{1,7})?$/,message:window.keys.regexRequired}}},"large[price]":{validators:{regexp:{regexp:/^[0-9]+(\.[0-9]{1,7})?$/,message:window.keys.regexRequired}}},selected_ingredients:{validators:{notEmpty:{message:window.keys.ingredientsRequired}}}},plugins:{trigger:new FormValidation.plugins.Trigger,bootstrap:new FormValidation.plugins.Bootstrap5({rowSelector:".fv-row",eleInvalidClass:"",eleValidClass:""})}});let u=$("#colorDiv"),m=$("#infoSpanColor"),f=$("#iconDiv"),y=$("#infoSpan"),g=$("#secondIconDiv"),h=$("#secondSpanDiv");u.show(),f.hide(),$('#kt_security_summary_tabs a[data-bs-toggle="tab"]').click(function(){switch($(this).attr("href")){case"#kt_security_summary_tab_pane_hours":u.show(),m.show(),f.hide(),y.hide(),g.hide(),h.hide();break;case"#kt_security_summary_tab_pane_day":u.hide(),m.hide(),f.show(),y.show(),g.hide(),h.hide();break;case"#kt_security_summary_tab_pane_second":u.hide(),m.hide(),f.hide(),y.hide(),g.show(),h.show();break;default:u.show(),m.show(),f.hide(),y.hide(),g.hide(),h.hide()}});let a=$("#size_table");$("#activated").change(function(){$(this).is(":checked")?(a.css("display","table"),a.find(".large").css("display","none"),a.find(".medium").css("display",""),a.find(".small").css("display",""),a.find("#medium").prop("checked",!0),a.find("#small").prop("checked",!0)):(a.find('input[type="checkbox"]').prop("checked",!1),a.css("display","none"))}),$("#large").change(function(){$(this).is(":checked")?a.find(".large").css("display",""):(a.find(".large").css("display","none"),a.find(".large").val(0))}),$("#small").change(function(){$(this).is(":checked")?(a.find(".small").css("display",""),$('.medium input[type="number"]').prop("disabled",!1).val(0),$('.large input[type="number"]').prop("disabled",!1).val(0)):(a.find(".small").css("display","none"),$('.medium input[type="number"]').prop("disabled",!0).val(0),a.find(".small").val(0),a.find("#medium").is(":checked")||$('.large input[type="number"]').prop("disabled",!0).val(0))}),$("#medium").change(function(){$(this).is(":checked")?(a.find(".medium").css("display",""),$('.large input[type="number"]').prop("disabled",!1),a.find("#small").is(":checked")||$('.medium input[type="number"]').prop("disabled",!0).val(0)):(a.find(".medium").css("display","none"),a.find(".medium").val(0),a.find("#small").is(":checked")||$('.large input[type="number"]').prop("disabled",!0).val(0))}),$("#categories").change(function(){var t=$(this).find("option:selected"),r=t.data("color");$(".categoryColor").css("background-color",r)});var v=[];const c=$('label[for="cost"]').data("currency")??"â‚¬",k=$('label[for="cost"]').data("direction")??"end";$("#ingredientDropdown").on("change",function(){var t=JSON.parse($(this).val()),r="/admin/ingredient/"+t.id+"/edit";if(!t||v.includes(t.id))return;{v.push(t.id);var o=$("#kt_customers_table tbody"),e=$('<tr id="'+t.id+'"></tr>'),d=[];for(var i in window.units)((t.unit.toLowerCase()==="kilogram"||t.unit.toLowerCase()==="gram")&&(i.toLowerCase()==="kilogram"||i.toLowerCase()==="gram")||(t.unit.toLowerCase()==="liter"||t.unit.toLowerCase()==="milliliter")&&(i.toLowerCase()==="liter"||i.toLowerCase()==="milliliter")||t.unit===window.units[i])&&d.push("<option "+(t.unit===window.units[i]?"selected":"")+' value="'+i+'">'+window.units[i]+"</option>");let l=t.unit.toLowerCase()==="milliliter"||t.unit.toLowerCase()==="gram"?.001:1;e.append('<input id="qty-'+t.id+'" data-qty-final="'+t.id+'" type="hidden" name="ingredients['+t.id+'][qty]" value=1>'),e.append('<input id="qty-'+t.id+'" data-unit-final="'+t.id+'" type="hidden" name="ingredients['+t.id+'][unit]" value="'+t.unit+'">'),e.append('<input id="qty-'+t.id+'" data-cost-final="'+t.id+'" type="hidden" name="ingredients['+t.id+'][cost]" value="'+t.cost+'">'),e.append('<input id="qty-'+t.id+'" data-price-final="'+t.id+'" type="hidden" name="ingredients['+t.id+'][price]" value="'+t.price+'">'),e.append('<input id="qty-'+t.id+'" data-cost-per-unit-final="'+t.id+'" type="hidden" name="ingredients['+t.id+'][cost_per_unit]" value="'+l*t.cost+'">'),e.append('<input id="qty-'+t.id+'" data-price-per-unit-final="'+t.id+'" type="hidden" name="ingredients['+t.id+'][price_per_unit]" value="'+l*t.price+'">'),e.append('<td class="text-gray-900"><a href="'+r+'" class="text-gray-800 text-hover-primary mb-1">'+t.name+"</a></td>"),e.append('<td class="text-gray-900" data-quantity = "'+t.quantity+'">'+parseFloat(t.quantity)+" "+t.unit+"</td>"),e.append('<td class="text-gray-900"><input data-system-unit="'+t.unit+'"  value="1" type="number" step="0.1" data-qty="qty" class="form-control qty-units"></td>'),e.append('<td class="text-gray-900"><select class="form-select form-control qty-units" data-control="select2" data-hide-search="true" data-unit="unit"><option></option>'+d.join("")+"</select></td>"),k=="end"?(e.append('<td class="text-gray-900" data-final-cost = "'+parseFloat(t.cost).toFixed(2)+'" data-cost = "'+parseFloat(t.cost).toFixed(2)+'">'+parseFloat(t.cost).toFixed(2)+"  "+c+"</td>"),e.append('<td class="text-gray-900" data-final-price = "'+parseFloat(t.price).toFixed(2)+'" data-price = "'+parseFloat(t.price).toFixed(2)+'">'+parseFloat(t.price).toFixed(2)+"  "+c+"</td>")):(e.append('<td class="text-gray-900" data-final-cost = "'+parseFloat(t.cost).toFixed(2)+'" data-cost = "'+parseFloat(t.cost).toFixed(2)+'">'+c+" "+parseFloat(t.cost).toFixed(2)+"</td>"),e.append('<td class="text-gray-900" data-final-price = "'+parseFloat(t.price).toFixed(2)+'" data-price = "'+parseFloat(t.price).toFixed(2)+'">'+c+" "+parseFloat(t.price).toFixed(2)+"</td>")),e.append('<td class="float-right pe-0"><div class="float-end menu-item px-3 pe-0"><a href="javascript:void(0)" class="menu-link px-3 text-danger" data-ingredient-id="new_id" data-kt-customer-table-filter="delete_row">Delete</a></div></td>'),o.append(e)}var n=0,s=0;$("#kt_customers_table tbody tr").each(function(){let l=parseInt($(this).find("#qty-"+this.id).val());n+=$(this).find("[data-cost]").attr("data-cost")*l,s+=$(this).find("[data-price]").attr("data-price")*l}),$("#cost").val(n.toFixed(2)),$("#price").val(s.toFixed(2));let p=document.getElementById("ingredientDropdown");p.selectedIndex=-1;try{KTMenu.init()}catch{}}),$("#kt_customers_table tbody").on("input",".qty-units",function(){let t=$(this).closest("tr"),r=t.find("[data-qty]").val(),o=t.find("[data-unit]").val(),e=parseFloat(t.find("[data-cost]").data("cost")),d=parseFloat(t.find("[data-price]").data("price")),i=t.find("[data-system-unit]").data("system-unit"),n,s;const p=i.toLowerCase(),l=o.toLowerCase(),x={liter:{milliliter:.001},milliliter:{liter:1e3},kilogram:{gram:.001},gram:{kilogram:1e3}};if(p===l||l==="unit")n=e*r,s=d*r;else if(x.hasOwnProperty(p)&&x[p].hasOwnProperty(l)){const q=x[p][l];n=e*r*q,s=d*r*q}else alert("The units are incorrect!");t.find("[data-qty-final]").val(r),t.find("[data-unit-final]").val(o);let _=o.toLowerCase()==="milliliter"||o.toLowerCase()==="gram"?.001:1;t.find("[data-cost-final]").val(n),t.find("[data-price-final]").val(s),t.find("[data-cost-per-unit-final]").val(n*_),t.find("[data-price-per-unit-final]").val(s*_),t.find("[data-final-cost]").attr("data-final-cost",n.toFixed(2)),t.find("[data-final-price]").attr("data-final-price",s.toFixed(2)),k==="end"?(t.find("[data-cost]").text(n.toFixed(2)+" "+c),t.find("[data-price]").text(s.toFixed(2)+" "+c),t.find("[data-final-cost]").attr("data-final-cost",n.toFixed(2))):(t.find("[data-cost]").text(c+" "+n.toFixed(2)),t.find("[data-price]").text(c+" "+s.toFixed(2)),t.attr("data-final-cost",n.toFixed(2)),t.attr("data-final-price",s.toFixed(2)));let F=0,C=0;$("#kt_customers_table tbody tr").each(function(){F+=parseFloat($(this).find("[data-final-cost]").attr("data-final-cost")),C+=parseFloat($(this).find("[data-final-price]").attr("data-final-price"))}),$("#cost").val(F.toFixed(2)),$("#price").val(C.toFixed(2))}),$("#kt_customers_table tbody").on("click",'[data-kt-customer-table-filter="delete_row"]',function(){var t=$(this).closest("tr");if(t.length>0){var r=t[0].id;t.remove(),v=v.filter(function(d){return d!==r})}let o=0,e=0;$("#kt_customers_table tbody tr").each(function(){o+=parseFloat($(this).find("[data-final-cost]").attr("data-final-cost")),e+=parseFloat($(this).find("[data-final-price]").attr("data-final-price"))}),$("#cost").val(o.toFixed(2)),$("#price").val(e.toFixed(2))}),$("#submitButton").on("click",function(){$("#kt_ecommerce_add_product_form").submit()}),$("#kt_ecommerce_add_product_form").submit(function(t){let r=["small","medium","large"],o=0;r.forEach(function(e){$("#"+e).is(":checked")&&o++}),$("#kt_customers_table tbody tr").length===0?$("#selected_ingredients").val(""):$("#selected_ingredients").val("has ingredients"),t.preventDefault(),w&&w.validate().then(function(e){if(e=="Valid")if(o===1)Swal.fire({text:window.keys.sizeProducts,icon:"error",buttonsStyling:!1,confirmButtonText:window.keys.confirmButtonOk,customClass:{confirmButton:"btn btn-primary"}});else{let d=new FormData($("#kt_ecommerce_add_product_form")[0]);$.ajax({url:"/admin/foodItem",type:"POST",data:d,contentType:!1,processData:!1,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(i){Swal.fire({text:window.keys.productSuccessfullyAdded,icon:"success",buttonsStyling:!1,confirmButtonText:window.keys.confirmButtonOk,allowOutsideClick:!1,customClass:{confirmButton:"btn btn-primary"}}).then(function(){location.reload()})},statusCode:{422:function(i){let n=window.keys.ekioskErrorMessage+`

`;for(let s in i.responseJSON.errors)n+=`${i.responseJSON.errors[s].join(", ")}
`;Swal.fire({text:n,icon:"error",buttonsStyling:!1,confirmButtonText:window.keys.confirmButtonOk,customClass:{confirmButton:"btn btn-primary"}})}},error:function(i){Swal.fire({text:window.keys.ekioskServerErrors,icon:"error",buttonsStyling:!1,confirmButtonText:window.keys.confirmButtonOk,customClass:{confirmButton:"btn btn-primary"}})}})}else Swal.fire({text:window.keys.ekioskErrorsDetected,icon:"error",buttonsStyling:!1,confirmButtonText:window.keys.confirmButtonOk,customClass:{confirmButton:"btn btn-primary"}})})})};return{init:function(){b=document.querySelector("#kt_ecommerce_add_product_form"),S()}}}();KTUtil.onDOMContentLoaded(function(){B.init()});
