var x=function(){var f,y,k=function(){f=FormValidation.formValidation(y,{fields:{name:{validators:{notEmpty:{message:window.keys.dealName}}},"foodItems[]":{validators:{notEmpty:{message:window.keys.productName}}},categories:{validators:{notEmpty:{message:window.keys.categoryRequired}}},price:{validators:{notEmpty:{message:window.keys.priceRequired},regexp:{regexp:/^[0-9]+(\.[0-9]{1,7})?$/,message:window.keys.regexRequired}}},cost:{validators:{notEmpty:{message:window.keys.costRequired},regexp:{regexp:/^[0-9]+(\.[0-9]{1,7})?$/,message:window.keys.regexRequired}}},selected_foodItems:{validators:{notEmpty:{message:window.keys.productName}}}},plugins:{trigger:new FormValidation.plugins.Trigger,bootstrap:new FormValidation.plugins.Bootstrap5({rowSelector:".fv-row",eleInvalidClass:"",eleValidClass:""})}});let n=$("#colorDiv"),p=$("#infoSpanColor"),c=$("#iconDiv"),u=$("#infoSpan");n.show(),c.hide(),$('#kt_security_summary_tabs a[data-bs-toggle="tab"]').click(function(){switch($(this).attr("href")){case"#kt_security_summary_tab_pane_hours":n.show(),p.show(),c.hide(),u.hide();break;case"#kt_security_summary_tab_pane_day":n.hide(),p.hide(),c.show(),u.show();break;default:n.show(),p.show(),c.hide(),u.hide()}}),$("#categories").change(function(){var t=$(this).find("option:selected"),i=t.data("color");$(".categoryColor").css("background-color",i)});var l=[];const r=$('label[for="cost"]').data("currency")??"â‚¬",g=$('label[for="cost"]').data("direction")??"end";$("#foodItemDropdown").on("change",function(){var t=JSON.parse($(this).val()),i="/admin/foodItem/"+t.id+"/edit";if(!t)return;if(l.includes(t.id)){let a=$("#"+t.id),v=a.find("#qty-"+t.id),d=parseInt(v.val(parseInt(v.val())+1).val());parseInt(a.find("[data-qty]").text(d)),g=="end"?(a.find("[data-cost]").text((d*a.find("[data-cost]").attr("data-cost")).toFixed(2)+" "+r),a.find("[data-price]").text((d*a.find("[data-price]").attr("data-price")).toFixed(2)+" "+r)):(a.find("[data-cost]").text(r+" "+(d*a.find("[data-cost]").attr("data-cost")).toFixed(2)),a.find("[data-price]").text(r+" "+(d*a.find("[data-price]").attr("data-price")).toFixed(2)))}else{l.push(t.id);var s=$("#kt_customers_table tbody"),e=$('<tr id="'+t.id+'"></tr>');e.append('<input id="qty-'+t.id+'" type="hidden" name="foodItems['+t.id+']" value="1">'),e.append('<td class="text-gray-900"><a href="'+i+'" class="text-gray-800 text-hover-primary mb-1">'+t.name+"</a></td>"),e.append('<td class="text-gray-900" data-qty = "1">1</td>'),g=="end"?(e.append('<td class="text-gray-900" data-cost = "'+parseFloat(t.cost).toFixed(2)+'">'+parseFloat(t.cost).toFixed(2)+"  "+r+"</td>"),e.append('<td class="text-gray-900" data-price = "'+parseFloat(t.price).toFixed(2)+'">'+parseFloat(t.price).toFixed(2)+"  "+r+"</td>")):(e.append('<td class="text-gray-900" data-cost = "'+parseFloat(t.cost).toFixed(2)+'">'+r+" "+parseFloat(t.cost).toFixed(2)+"</td>"),e.append('<td class="text-gray-900" data-price = "'+parseFloat(t.price).toFixed(2)+'">'+r+" "+parseFloat(t.price).toFixed(2)+"</td>")),e.append('<td class="float-right pe-0"><div class="float-end menu-item px-3 pe-0"><a href="javascript:void(0)" class="menu-link px-3 text-danger" data-ingredient-id="new_id" data-kt-customer-table-filter="delete_row">Delete</a></div></td>'),s.append(e)}var o=0,m=0;$("#kt_customers_table tbody tr").each(function(){let a=parseInt($(this).find("#qty-"+this.id).val());o+=$(this).find("[data-cost]").attr("data-cost")*a,m+=$(this).find("[data-price]").attr("data-price")*a}),$("#cost").val(o),$("#price").val(m);let h=document.getElementById("foodItemDropdown");h.selectedIndex=-1;try{KTMenu.init()}catch{}}),$("#kt_customers_table tbody").on("click",'[data-kt-customer-table-filter="delete_row"]',function(){var t=$(this).closest("tr");if(t.length>0){var i=t[0].id;t.remove(),l=l.filter(function(o){return o!==i})}var s=0,e=0;$("#kt_customers_table tbody tr").each(function(){let o=parseInt($(this).find("#qty-"+this.id).val());e+=$(this).find("[data-cost]").attr("data-cost")*o,s+=$(this).find("[data-price]").attr("data-price")*o}),$("#price").val(s),$("#cost").val(e)}),$("#submitButton").on("click",function(){$("#kt_ecommerce_add_meal_form").submit()}),$("#kt_ecommerce_add_meal_form").submit(function(t){$("#kt_customers_table tbody tr").length===0?$("#selected_foodItems").val(""):$("#selected_foodItems").val("has food items"),t.preventDefault(),f&&f.validate().then(function(i){if(i=="Valid"){var s=new FormData($("#kt_ecommerce_add_meal_form")[0]);$.ajax({url:"/admin/meal",type:"POST",data:s,contentType:!1,processData:!1,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(e){Swal.fire({text:window.keys.dealSuccessfullyAdded,icon:"success",buttonsStyling:!1,confirmButtonText:window.keys.confirmButtonOk,customClass:{confirmButton:"btn btn-primary"}}).then(function(){location.reload()})},statusCode:{422:function(e){let o=window.keys.ekioskErrorMessage+`

`;for(let m in e.responseJSON.errors)o+=`${e.responseJSON.errors[m].join(", ")}
`;Swal.fire({text:o,icon:"error",buttonsStyling:!1,confirmButtonText:window.keys.confirmButtonOk,customClass:{confirmButton:"btn btn-primary"}})}},error:function(e){Swal.fire({text:window.keys.ekioskServerErrors,icon:"error",buttonsStyling:!1,confirmButtonText:window.keys.confirmButtonOk,customClass:{confirmButton:"btn btn-primary"}})}})}else Swal.fire({text:window.keys.ekioskErrorsDetected,icon:"error",buttonsStyling:!1,confirmButtonText:window.keys.confirmButtonOk,customClass:{confirmButton:"btn btn-primary"}})})})};return{init:function(){y=document.querySelector("#kt_ecommerce_add_meal_form"),k()}}}();KTUtil.onDOMContentLoaded(function(){x.init()});
