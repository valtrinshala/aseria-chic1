var T=function(){var u,i,g=function(){i.querySelectorAll("tbody tr").forEach(r=>{const n=r.querySelectorAll("td"),s=moment(n[8].innerHTML,"DD MMM YYYY, LT").format();n[8].setAttribute("data-order",s)}),u=$(i).DataTable({info:!1,order:[],columnDefs:[{orderable:!1,targets:0},{orderable:!1,targets:8}]}),u.on("draw",function(){y(),b(),p(),KTMenu.init()})};document.querySelector("#kt_ecommerce_sales_flatpickr_clear").addEventListener("click",e=>{flatpickr.clear()});const x=document.querySelector("#kt_ecommerce_sales_flatpickr");flatpickr=$(x).flatpickr({altInput:!0,altFormat:"d/m/Y",dateFormat:"Y-m-d",mode:"range",onChange:function(e,r,n){if(e.length===2||e.length===0){const s=$(".z-report-filter-table");if(s.length==0){console.error("No tables found.");return}const c=s[0],t=$(c).DataTable();t.clear().draw(),$.ajax({url:"/admin/zReport/all/zReportByDate",type:"GET",data:{date:r},success:function(o){var m,w,k;const d=c.getAttribute("csl"),f=c.getAttribute("sym");if(!o||!o.data||!Array.isArray(o.data)){console.error("Invalid response format or missing data.");return}for(let a of o.data){d==0?parseFloat(a.total_sales).toFixed(2)+""+f:f+""+parseFloat(a.total_sales).toFixed(2);const l=$("<tr>");l.append('<td class="text-gray-800 fs-10.5 flex-column justify-content-center my-0">'+parseFloat(a.report_number)+"</td>"),l.append('<td class="text-gray-800 fs-10.5 flex-column justify-content-center my-0">'+((m=a.cash_register)==null?void 0:m.name)+"</td>"),l.append('<td class="text-gray-800 fs-10.5 flex-column justify-content-center my-0">'+((w=a.cash_register)==null?void 0:w.key)+"</td>"),l.append('<td class="text-gray-800 fs-10.5 flex-column justify-content-center my-0">'+((k=a.location)==null?void 0:k.name)+"</td>"),l.append('<td class="text-gray-800 fs-10.5 flex-column justify-content-center my-0">'+a.start_z_report+"</td>"),l.append('<td class="text-gray-800 fs-10.5 flex-column justify-content-center my-0">'+(a.end_z_report??" ")+"</td>"),l.append('<td class="text-gray-800 fs-10.5 flex-column justify-content-center my-0">'+parseInt(a.total_sales)+"</td>"),l.append('<td class="text-gray-800 fs-10.5 flex-column justify-content-center my-0">'+h(a.end_z_report)+"</td>"),l.append('<td class="text-end"><a href="/admin/pdf/zReport/'+a.id+'" class="btn btn-sm btn-light btn-flex'+(a.end_z_report?"":" disabled ")+'btn-center btn-active-light-primary border-0 bg-light-primary">Download<i class="ki-duotone ki-down fs-5 ms-1"></i></td>'),t.row.add(l)}t.draw()},statusCode:{422:function(o){let d=`Sorry, looks like there are some errors detected:

`;for(let f in o.responseJSON.errors)d+=`${o.responseJSON.errors[f].join(", ")}
`;Swal.fire({text:d,icon:"error",buttonsStyling:!1,confirmButtonText:window.keys.confirmButtonOk,customClass:{confirmButton:"btn btn-primary"}})}},error:function(o){Swal.fire({text:window.keys.ekioskServerErrors,icon:"error",buttonsStyling:!1,confirmButtonText:window.keys.confirmButtonOk,customClass:{confirmButton:"btn btn-primary"}})}})}}});function h(e){return e?'<div class="badge badge-light-danger">Closed</div>':'<div class="badge badge-light-success">Opened</div>'}var S=()=>{document.querySelector('[data-kt-customer-table-filter="search"]').addEventListener("keyup",function(r){u.search(r.target.value).draw()})},b=()=>{i.querySelectorAll('[data-kt-customer-table-filter="delete_row"]').forEach(r=>{r.addEventListener("click",function(n){n.preventDefault();const s=n.target.getAttribute("data-modifier-id"),c=n.target.closest("tr"),t=c.querySelectorAll("td")[1].innerText;Swal.fire({text:window.keys.deleteText+" "+t+"?",icon:"warning",showCancelButton:!0,buttonsStyling:!1,confirmButtonText:window.keys.confirmButtonText,cancelButtonText:window.keys.cancelButtonText,customClass:{confirmButton:"btn fw-bold btn-danger",cancelButton:"btn fw-bold btn-active-light-primary"}}).then(function(o){o.value?$.ajax({url:"/admin/modifier/"+s,method:"DELETE",contentType:!1,processData:!1,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(d){u.row($(c)).remove().draw()},error:function(d,f,m){console.error(d.responseText)}}):o.dismiss==="cancel"&&Swal.fire({text:t+" "+window.keys.notDeleted,icon:"error",buttonsStyling:!1,confirmButtonText:window.keys.confirmButtonOk,customClass:{confirmButton:"btn fw-bold btn-primary"}})})})})},y=()=>{const e=i.querySelectorAll('[type="checkbox"]'),r=document.querySelector('[data-kt-customer-table-select="delete_selected"]');e.forEach(n=>{n.addEventListener("click",function(){setTimeout(function(){p()},50)})}),r.addEventListener("click",function(){Swal.fire({text:window.keys.deleteReports,icon:"warning",showCancelButton:!0,buttonsStyling:!1,confirmButtonText:window.keys.confirmButtonText,cancelButtonText:window.keys.cancelButtonText,customClass:{confirmButton:"btn fw-bold btn-danger",cancelButton:"btn fw-bold btn-active-light-primary"}}).then(function(n){if(n.value){let s=[];e.forEach(t=>{t.checked&&(s.push(t.value),u.row($(t.closest("tbody tr"))).remove().draw())}),$.ajax({url:"/admin/modifier/delete/selected",method:"POST",data:{ids:s},headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},error:function(t,o,d){console.error(t.responseText)}});const c=i.querySelectorAll('[type="checkbox"]')[0];c.checked=!1}else n.dismiss==="cancel"&&Swal.fire({text:window.keys.selectedReports,icon:"error",buttonsStyling:!1,confirmButtonText:window.keys.confirmButtonOk,customClass:{confirmButton:"btn fw-bold btn-primary"}})})})};const p=()=>{const e=document.querySelector('[data-kt-customer-table-toolbar="base"]'),r=document.querySelector('[data-kt-customer-table-toolbar="selected"]'),n=document.querySelector('[data-kt-customer-table-select="selected_count"]'),s=i.querySelectorAll('tbody [type="checkbox"]');let c=!1,t=0;s.forEach(o=>{o.checked&&(c=!0,t++)}),c?(n.innerHTML=t,e.classList.add("d-none"),r.classList.remove("d-none")):(e.classList.remove("d-none"),r.classList.add("d-none"))};return{init:function(){i=document.querySelector("#kt_customers_table"),i&&(g(),y(),S(),b())}}}();KTUtil.onDOMContentLoaded(function(){T.init()});
