var k=function(){var f,y,x=function(){f=FormValidation.formValidation(y,{fields:{name:{validators:{notEmpty:{message:window.keys.productNameRequired}}},"ingredients[]":{validators:{notEmpty:{message:window.keys.ingredientsRequired}}},categories:{validators:{notEmpty:{message:window.keys.categoryRequired}}},price:{validators:{notEmpty:{message:window.keys.priceRequired},regexp:{regexp:/^[0-9]+(\.[0-9]{1,7})?$/,message:window.keys.regexRequired}}},cost:{validators:{notEmpty:{message:"Cost is required"},regexp:{regexp:/^[0-9]+(\.[0-9]{1,7})?$/,message:window.keys.regexRequired}}},"small[price]":{validators:{regexp:{regexp:/^[0-9]+(\.[0-9]{1,7})?$/,message:window.keys.regexRequired}}},"medium[price]":{validators:{regexp:{regexp:/^[0-9]+(\.[0-9]{1,7})?$/,message:window.keys.regexRequired}}},"large[price]":{validators:{regexp:{regexp:/^[0-9]+(\.[0-9]{1,7})?$/,message:window.keys.regexRequired}}},selected_ingredients:{validators:{notEmpty:{message:window.keys.ingredientsRequired}}}},plugins:{trigger:new FormValidation.plugins.Trigger,bootstrap:new FormValidation.plugins.Bootstrap5({rowSelector:".fv-row",eleInvalidClass:"",eleValidClass:""})}});let a=$("#size_table");$("#activated").change(function(){$(this).is(":checked")?(a.css("display","table"),a.find(".large").css("display","none"),a.find(".medium").css("display","").removeClass("size-table-switch"),a.find(".small").css("display","").removeClass("size-table-switch"),a.find("#medium").prop("checked",!0),a.find("#small").prop("checked",!0),$('.medium input[type="number"]').prop("disabled",!1).val(0)):(a.find('input[type="checkbox"]').prop("checked",!1),a.css("display","none"))}),$("#large").change(function(){$(this).is(":checked")?a.find(".large").css("display","").removeClass("size-table-switch"):(a.find(".large").css("display","none"),a.find(".large").val(0))}),$("#small").change(function(){$(this).is(":checked")?(a.find(".small").css("display","").removeClass("size-table-switch"),$('.medium input[type="number"]').prop("disabled",!1).val(0),$('.large input[type="number"]').prop("disabled",!1)):(a.find(".small").css("display","none"),$('.medium input[type="number"]').prop("disabled",!0).val(0),a.find(".small").val(0),a.find("#medium").is(":checked")||$('.large input[type="number"]').prop("disabled",!0).val(0))}),$("#medium").change(function(){$(this).is(":checked")?(a.find(".medium").css("display","").removeClass("size-table-switch"),$('.large input[type="number"]').prop("disabled",!1),a.find("#small").is(":checked")||$('.medium input[type="number"]').prop("disabled",!0).val(0)):(a.find(".medium").css("display","none"),a.find(".medium").val(0),a.find("#small").is(":checked")||$('.large input[type="number"]').prop("disabled",!0).val(0))}),$("#categories").change(function(){var t=$(this).find("option:selected"),n=t.data("color");$(".categoryColor").css("background-color",n)});let u=[];$("#kt_customers_table tbody tr").each(function(){u.push(this.id)});const c=$('label[for="cost"]').data("currency")??"â‚¬",g=$('label[for="cost"]').data("direction")??"end";$("#ingredientDropdown").on("change",function(){let t=JSON.parse($(this).val()),n="/admin/ingredient/"+t.id+"/edit";if(!t||u.includes(t.id))return;{u.push(t.id);var s=$("#kt_customers_table tbody"),e=$('<tr id="'+t.id+'"></tr>'),r=[];for(var i in window.units)((t.unit.toLowerCase()==="kilogram"||t.unit.toLowerCase()==="gram")&&(i.toLowerCase()==="kilogram"||i.toLowerCase()==="gram")||(t.unit.toLowerCase()==="liter"||t.unit.toLowerCase()==="milliliter")&&(i.toLowerCase()==="liter"||i.toLowerCase()==="milliliter")||t.unit===window.units[i])&&r.push("<option "+(t.unit===window.units[i]?"selected":"")+' value="'+i+'">'+window.units[i]+"</option>");let l=t.unit.toLowerCase()==="milliliter"||t.unit.toLowerCase()==="gram"?.001:1;e.append('<input id="qty-'+t.id+'" data-qty-final="'+t.id+'" type="hidden" name="ingredients['+t.id+'][qty]" value=1>'),e.append('<input id="qty-'+t.id+'" data-unit-final="'+t.id+'" type="hidden" name="ingredients['+t.id+'][unit]" value="'+t.unit+'">'),e.append('<input id="qty-'+t.id+'" data-cost-final="'+t.id+'" type="hidden" name="ingredients['+t.id+'][cost]" value="'+t.cost+'">'),e.append('<input id="qty-'+t.id+'" data-price-final="'+t.id+'" type="hidden" name="ingredients['+t.id+'][price]" value="'+t.price+'">'),e.append('<input id="qty-'+t.id+'" data-cost-per-unit-final="'+t.id+'" type="hidden" name="ingredients['+t.id+'][cost_per_unit]" value="'+l*t.cost+'">'),e.append('<input id="qty-'+t.id+'" data-price-per-unit-final="'+t.id+'" type="hidden" name="ingredients['+t.id+'][price_per_unit]" value="'+l*t.price+'">'),e.append('<td class="text-gray-900"><a href="'+n+'" class="text-gray-800 text-hover-primary mb-1">'+t.name+"</a></td>"),e.append('<td class="text-gray-900" data-quantity = "'+t.quantity+'">'+parseFloat(t.quantity)+" "+t.unit+"</td>"),e.append('<td class="text-gray-900"><input data-system-unit="'+t.unit+'"  value="1" type="number" step="0.1" data-qty="qty" class="form-control qty-units"></td>'),e.append('<td class="text-gray-900"><select class="form-select form-control qty-units" data-control="select2" data-hide-search="true" data-unit="unit"><option></option>'+r.join("")+"</select></td>"),g=="end"?(e.append('<td class="text-gray-900" data-final-cost = "'+parseFloat(t.cost).toFixed(2)+'" data-cost = "'+parseFloat(t.cost).toFixed(2)+'">'+parseFloat(t.cost).toFixed(2)+"  "+c+"</td>"),e.append('<td class="text-gray-900" data-final-price = "'+parseFloat(t.price).toFixed(2)+'" data-price = "'+parseFloat(t.price).toFixed(2)+'">'+parseFloat(t.price).toFixed(2)+"  "+c+"</td>")):(e.append('<td class="text-gray-900" data-final-cost = "'+parseFloat(t.cost).toFixed(2)+'" data-cost = "'+parseFloat(t.cost).toFixed(2)+'">'+c+" "+parseFloat(t.cost).toFixed(2)+"</td>"),e.append('<td class="text-gray-900" data-final-price = "'+parseFloat(t.price).toFixed(2)+'" data-price = "'+parseFloat(t.price).toFixed(2)+'">'+c+" "+parseFloat(t.price).toFixed(2)+"</td>")),e.append('<td class="float-right pe-0"><div class="float-end menu-item px-3 pe-0"><a href="javascript:void(0)" class="menu-link px-3 text-danger" data-ingredient-id="new_id" data-kt-customer-table-filter="delete_row">Delete</a></div></td>'),s.append(e)}var o=0,d=0;$("#kt_customers_table tbody tr").each(function(){let l=parseInt($(this).find("#qty-"+this.id).val());o+=$(this).find("[data-cost]").attr("data-cost")*l,d+=$(this).find("[data-price]").attr("data-price")*l}),$("#cost").val(o.toFixed(2)),$("#price").val(d.toFixed(2));let p=document.getElementById("ingredientDropdown");p.selectedIndex=-1;try{KTMenu.init()}catch{}}),$("#kt_customers_table tbody").on("input",".qty-units",function(){let t=$(this).closest("tr"),n=t.find("[data-qty]").val(),s=t.find("[data-unit]").val(),e=parseFloat(t.find("[data-cost]").data("cost")),r=parseFloat(t.find("[data-price]").data("price")),i=t.find("[data-system-unit]").data("system-unit"),o,d;const p=i.toLowerCase(),l=s.toLowerCase(),m={liter:{milliliter:.001},milliliter:{liter:1e3},kilogram:{gram:.001},gram:{kilogram:1e3}};if(p===l||l==="unit")o=e*n,d=r*n;else if(m.hasOwnProperty(p)&&m[p].hasOwnProperty(l)){const w=m[p][l];o=e*n*w,d=r*n*w}else alert("The units are incorrect!");t.find("[data-qty-final]").val(n),t.find("[data-unit-final]").val(s);let h=s.toLowerCase()==="milliliter"||s.toLowerCase()==="gram"?.001:1;t.find("[data-cost-final]").val(o),t.find("[data-price-final]").val(d),t.find("[data-cost-per-unit-final]").val(o*h),t.find("[data-price-per-unit-final]").val(d*h),t.find("[data-final-cost]").attr("data-final-cost",o.toFixed(2)),t.find("[data-final-price]").attr("data-final-price",d.toFixed(2)),g==="end"?(t.find("[data-cost]").text(o.toFixed(2)+" "+c),t.find("[data-price]").text(d.toFixed(2)+" "+c),t.find("[data-final-cost]").attr("data-final-cost",o.toFixed(2))):(t.find("[data-cost]").text(c+" "+o.toFixed(2)),t.find("[data-price]").text(c+" "+d.toFixed(2)),t.attr("data-final-cost",o.toFixed(2)),t.attr("data-final-price",d.toFixed(2)));let v=0,b=0;$("#kt_customers_table tbody tr").each(function(){v+=parseFloat($(this).find("[data-final-cost]").attr("data-final-cost")),b+=parseFloat($(this).find("[data-final-price]").attr("data-final-price"))}),$("#cost").val(v.toFixed(2)),$("#price").val(b.toFixed(2))}),$("#kt_customers_table tbody").on("click",'[data-kt-customer-table-filter="delete_row"]',function(){var t=$(this).closest("tr");if(t.length>0){var n=t[0].id;t.remove(),u=u.filter(function(r){return r!==n})}let s=0,e=0;$("#kt_customers_table tbody tr").each(function(){s+=parseFloat($(this).find("[data-final-cost]").attr("data-final-cost")),e+=parseFloat($(this).find("[data-final-price]").attr("data-final-price"))}),$("#cost").val(s.toFixed(2)),$("#price").val(e.toFixed(2))}),$(document).ready(function(){var t=$("#colorDiv");let n=$("#infoSpanColor");var s=$("#iconDiv"),e=$("#infoSpan");let r=$("#secondIconDiv"),i=$("#secondSpanDiv");t.show(),s.hide(),r.hide(),$('#kt_security_summary_tabs a[data-bs-toggle="tab"]').click(function(){var o=$(this).attr("href");switch(o){case"#kt_security_summary_tab_pane_hours":t.show(),n.show(),s.hide(),infoSpanDiv.hide(),r.hide(),i.hide();break;case"#kt_security_summary_tab_pane_day":t.hide(),n.hide(),s.show(),e.show(),r.hide(),i.hide();break;case"#kt_security_summary_tab_pane_second":t.hide(),n.hide(),s.hide(),infoSpanDiv.hide(),r.show(),i.show();break;default:t.show(),n.show(),s.hide(),e.hide(),r.hide(),i.hide()}})}),$("#submitButton").on("click",function(){$("#kt_ecommerce_add_product_form").submit()}),$("#kt_ecommerce_add_product_form").submit(function(t){let n=["small","medium","large"],s=0;n.forEach(function(e){$("#"+e).is(":checked")&&s++}),$("#kt_customers_table tbody tr").length===0?$("#selected_ingredients").val(""):$("#selected_ingredients").val("has ingredients"),t.preventDefault(),f&&f.validate().then(function(e){if(e=="Valid")if(s===1)Swal.fire({text:window.keys.sizeProducts,icon:"error",buttonsStyling:!1,confirmButtonText:window.keys.confirmButtonOk,customClass:{confirmButton:"btn btn-primary"}});else{let r=new FormData($("#kt_ecommerce_add_product_form")[0]);r.append("_method","PUT"),$.ajax({url:"/admin/foodItem/"+$("#pageId").val(),type:"POST",data:r,contentType:!1,processData:!1,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(i){Swal.fire({text:window.keys.foodItemUpdated,icon:"success",buttonsStyling:!1,confirmButtonText:window.keys.confirmButtonOk,customClass:{confirmButton:"btn btn-primary"}}).then(function(){location.href="/admin/foodItem"})},statusCode:{422:function(i){let o=window.keys.ekioskErrorMessage+`

`;for(let d in i.responseJSON.errors)o+=`${i.responseJSON.errors[d].join(", ")}
`;Swal.fire({text:o,icon:"error",buttonsStyling:!1,confirmButtonText:window.keys.confirmButtonOk,customClass:{confirmButton:"btn btn-primary"}})}},error:function(i){Swal.fire({text:window.keys.ekioskServerErrors,icon:"error",buttonsStyling:!1,confirmButtonText:window.keys.confirmButtonOk,customClass:{confirmButton:"btn btn-primary"}})}})}else Swal.fire({text:window.keys.ekioskErrorsDetected,icon:"error",buttonsStyling:!1,confirmButtonText:window.keys.confirmButtonOk,customClass:{confirmButton:"btn btn-primary"}})})})};return{init:function(){y=document.querySelector("#kt_ecommerce_add_product_form"),x()}}}();KTUtil.onDOMContentLoaded(function(){k.init()});
